/***************************************************************************//**
 * # License
 *
 * The licensor of this software is Silicon Laboratories Inc. Your use of this
 * software is governed by the terms of Silicon Labs Master Software License
 * Agreement (MSLA) available at
 * www.silabs.com/about-us/legal/master-software-license-agreement. This
 * software is Third Party Software licensed by Silicon Labs from a third party
 * and is governed by the sections of the MSLA applicable to Third Party
 * Software and the additional terms set forth below.
 *
 ******************************************************************************/

/*
 * COPYRIGHT (c) 2010-2015 MACRONIX INTERNATIONAL CO., LTD
 * SPI Flash Low Level Driver (LLD) Sample Code
 *
 * SPI interface command set
 *
 * $Id: MX25_CMD.c,v 1.31 2015/03/24 01:06:33 mxclldb1 Exp $
 */

#include "em_gpio.h"
#include "em_usart.h"
#include "em_cmu.h"

#include  "Maxdone_SPI_OLDE.h"

#define SPI_BAUDRATE   8000000
/* Local functions */
typedef enum
{
	font16_P,
	font16_T,
	font16_m,
	font16_H,
	font16_g,
	font16_c1,
	font16_c2,
	font16_R,
	font16_percent,
	font16_clean,
	font16_C,
	font16_u,
	font16_r,
	font16_S,
	font16_e,
	font16_t,
	font16_Ohm1,
	font16_Ohm2,
	font16_alert1,
	font16_alert2,
	font16_alert3,
	font16_alert4,
	font16_value1,
	font16_value2,
	font16_Current1,
	font16_Current2,
	font16_Current3,
	font16_Current4,
} font16enum;


/* Utility functions */
void Wait_Flash_WarmUp(void);
const unsigned char Font4816Dot[][46] = {
{/* 0 */
0x00,0x00,0x07,0xC0,0x0F,0xE0,0x0C,0x60,0x18,0x30,0x18,0x30,0x30,0x18,0x30,0x18,
0x30,0x18,0x30,0x18,0x30,0x18,0x30,0x18,0x30,0x18,0x30,0x18,0x30,0x18,0x30,0x18,
0x30,0x18,0x30,0x18,0x18,0x30,0x18,0x30,0x0C,0x60,0x0F,0xE0,0x07,0xC0,
},
{/* 1 */
0x00,0x00,0x00,0x08,0x00,0x18,0x00,0x38,0x00,0x38,0x00,0x78,0x00,0xF8,0x01,0x98,
0x01,0x18,0x00,0x18,0x00,0x18,0x00,0x18,0x00,0x18,0x00,0x18,0x00,0x18,0x00,0x18,
0x00,0x18,0x00,0x18,0x00,0x18,0x00,0x18,0x00,0x18,0x00,0x18,0x00,0x18,
},
{/* 2 */
0x00,0x00,0x07,0xC0,0x0F,0xE0,0x1C,0x70,0x18,0x38,0x30,0x18,0x30,0x18,0x00,0x18,
0x00,0x18,0x00,0x38,0x00,0x30,0x00,0x70,0x00,0x60,0x00,0xE0,0x01,0xC0,0x03,0x80,
0x07,0x00,0x0E,0x00,0x0E,0x00,0x1C,0x00,0x18,0x00,0x3F,0xF8,0x3F,0xF8,
},
{/* 3 */
0x00,0x00,0x07,0xC0,0x0F,0xE0,0x1C,0x30,0x38,0x18,0x30,0x18,0x00,0x18,0x00,0x18,
0x00,0x38,0x00,0x70,0x03,0xE0,0x03,0xF0,0x00,0x70,0x00,0x38,0x00,0x18,0x00,0x18,
0x00,0x18,0x30,0x18,0x30,0x18,0x18,0x30,0x1C,0x70,0x0F,0xE0,0x07,0xC0,
},
{/* 4 */
0x00,0x00,0x00,0x60,0x00,0xE0,0x00,0xE0,0x01,0xE0,0x01,0xE0,0x03,0xE0,0x03,0x60,
0x07,0x60,0x06,0x60,0x06,0x60,0x0C,0x60,0x0C,0x60,0x18,0x60,0x18,0x60,0x30,0x60,
0x3F,0xF8,0x3F,0xF8,0x00,0x60,0x00,0x60,0x00,0x60,0x00,0x60,0x00,0x60,
},
{/* 5 */
0x00,0x00,0x0F,0xF0,0x0F,0xF0,0x0C,0x00,0x18,0x00,0x18,0x00,0x18,0x00,0x18,0x00,
0x1B,0xC0,0x3F,0xE0,0x3C,0x70,0x38,0x30,0x10,0x18,0x00,0x18,0x00,0x18,0x00,0x18,
0x00,0x18,0x30,0x18,0x30,0x38,0x18,0x30,0x1C,0x70,0x0F,0xE0,0x07,0xC0,
},
{/* 6 */
0x00,0x00,0x03,0xC0,0x07,0xF0,0x0C,0x30,0x18,0x38,0x18,0x18,0x10,0x00,0x30,0x00,
0x30,0x00,0x33,0xC0,0x3F,0xE0,0x3C,0x70,0x38,0x30,0x30,0x18,0x30,0x18,0x30,0x18,
0x30,0x18,0x30,0x18,0x10,0x18,0x18,0x30,0x0C,0x70,0x0F,0xE0,0x03,0xC0,
},
{/* 7 */
0x00,0x00,0x3F,0xF8,0x3F,0xF8,0x00,0x18,0x00,0x30,0x00,0x60,0x00,0x60,0x00,0xC0,
0x00,0xC0,0x01,0x80,0x01,0x80,0x03,0x80,0x03,0x00,0x03,0x00,0x07,0x00,0x06,0x00,
0x06,0x00,0x06,0x00,0x0E,0x00,0x0C,0x00,0x0C,0x00,0x0C,0x00,0x0C,0x00,
},
{/* 8 */
0x00,0x00,0x07,0x80,0x0F,0xE0,0x0C,0x60,0x18,0x30,0x18,0x30,0x18,0x30,0x18,0x30,
0x18,0x30,0x0C,0x60,0x07,0xC0,0x0F,0xE0,0x1C,0x70,0x18,0x30,0x30,0x18,0x30,0x18,
0x30,0x18,0x30,0x18,0x30,0x18,0x18,0x30,0x1C,0x70,0x0F,0xE0,0x07,0xC0,
},
{/* 9 */
0x00,0x00,0x07,0x80,0x0F,0xE0,0x1C,0x60,0x18,0x30,0x30,0x10,0x30,0x18,0x30,0x18,
0x30,0x18,0x30,0x18,0x30,0x18,0x18,0x38,0x1C,0x78,0x0F,0xD8,0x07,0x98,0x00,0x18,
0x00,0x18,0x00,0x10,0x30,0x30,0x30,0x30,0x18,0x60,0x1F,0xC0,0x07,0x80,
},

{/*  */
0x00,
}
};

const unsigned char Font16[][16] =
{
{
	0x00,0x00,0x00,0xFE,0x63,0x63,0x63,0x63,0x7E,0x60,0x60,0x60,0x60,0xF0,0x00,0x00,/*"P",0*/
},
{
	0x00,0x00,0x00,0xFF,0xDB,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x3C,0x00,0x00,/*"T",1*/
},
{
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x6D,0x6D,0x6D,0x6D,0x6D,0xFF,0x00,0x00,/*"m",2*/
},
{
	0x00,0x00,0x00,0xF7,0x63,0x63,0x63,0x63,0x7F,0x63,0x63,0x63,0x63,0xF7,0x00,0x00,/*"H",3*/
},
{
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x3F,0x66,0x66,0x3C,0x60,0x3E,0x63,0x63,0x3E,/*"g",4*/
},
{
	//0x70,0x00,0xD9,0xFE,0xDF,0x0E,0x7E,0x06,0x0C,0x06,0x1C,0x00,0x1C,0x00,0x1C,0x00,
	//	0x70, 0xD9, 0xDF, 0x7E, 0x0C, 0x1C, 0x1C, 0x1C,
	//	0x1C, 0x1C, 0x1C, 0x0C, 0x0E, 0x07, 0x01, 0x00,
	//0x00,0x00,0x04,0x0A,0x0A,0x04,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	  0x00,0x00,0x00,0x00,0x00,0x02,0x05,0x05,0x02,0x00,0x00,0x00,0x00,0x00,0x00,0x00
},
{
	//0x1C,0x00,0x1C,0x00,0x1C,0x00,0x0C,0x00,0x0E,0x06,0x07,0x0C,0x01,0xF8,0x00,0x00,/*"℃",5*/
	//	0x00,0xFE,0x0E, 0x06, 0x06, 0x00, 0x00, 0x00,
	//	0x00, 0x00, 0x00 ,0x00 ,0x06 ,0x0C, 0xF8, 0x00,/*"℃",5*/

		0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x3C,0x46,0x40,0x40,0x42,0x66,0x38,0x00,0x00,/*"c",6*/
},
{

		0x00,0x00,0x00,0xFC,0xC6,0xC6,0xC6,0xC6,0xFC,0xCC,0xC6,0xC6,0xC3,0xC3,0x00,0x00, /* R */
},
{
		0x00,0x00,0x02,0x02,0xE4,0xA4,0xA8,0xE8,0x10,0x17,0x15,0x25,0x27,0x40,0x40,0x00,
},

{
	0,
},

	{0x00,0x00,0x00,0x3E,0x42,0x42,0x80,0x80,0x80,0x80,0x80,0x42,0x44,0x38,0x00,0x00},/*"C",0*/
	{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xC6,0x42,0x42,0x42,0x42,0x46,0x3B,0x00,0x00},/*"u",1*/
	{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xEE,0x32,0x20,0x20,0x20,0x20,0xF8,0x00,0x00},/*"r",2*/
	{0x00,0x00,0x00,0x3E,0x42,0x42,0x40,0x20,0x18,0x04,0x02,0x42,0x42,0x7C,0x00,0x00},/*"S",3*/
	{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x3C,0x42,0x42,0x7E,0x40,0x42,0x3C,0x00,0x00},/*"e",4*/
	{0x00,0x00,0x00,0x00,0x00,0x10,0x10,0x7C,0x10,0x10,0x10,0x10,0x12,0x0C,0x00,0x00},/*"t",5*/

	{0x00,0x00,0x0F,0x3F,0x78,0x60,0xC0,0xC0,0xC0,0xC0,0x60,0x30,0x18,0xFE,0xFE,0x00},
	{0x00,0x00,0xF0,0xFC,0x1E,0x06,0x03,0x03,0x03,0x03,0x06,0x0C,0x18,0x7F,0x7F,0x00},/*"Ω",0*/
	//{0x00,0x00,0x00,0x00,0x07,0x1C,0x38,0x30,0x30,0x30,0x18,0x0C,0x3E,0x00,0x00,0x00},
	//{0x00,0x00,0x00,0x00,0xE0,0x38,0x1C,0x0C,0x0C,0x0C,0x18,0x30,0x7C,0x00,0x00,0x00},/*"Ω",0*/
	{0x08,0x08,0x08,0x08,0x7E,0x08,0x08,0x0A,0x0C,0x18,0x68,0x08,0x08,0x08,0x28,0x10},
	{0x00,0xFE,0x82,0x82,0x8A,0x84,0x80,0xFE,0xA2,0xA2,0x94,0x94,0x88,0x94,0xA2,0xC1},/*"报",0*/
	{0x24,0xFF,0x24,0x7E,0x82,0x7A,0x4A,0x7A,0x05,0xFF,0x00,0x3F,0x00,0x3F,0x20,0x3F},
	{0x20,0x20,0x7E,0xC4,0x28,0x10,0x28,0xC6,0x00,0xFE,0x00,0xF8,0x00,0xF8,0x08,0xF8},/*"警",1*/
	{0x08,0x08,0x0F,0x10,0x10,0x33,0x32,0x53,0x92,0x13,0x12,0x13,0x12,0x12,0x1F,0x10},
	{0x40,0x40,0xFC,0x40,0x40,0xF8,0x08,0xF8,0x08,0xF8,0x08,0xF8,0x08,0x08,0xFE,0x00},/*"值",2*/
	{0x01,0x21,0x11,0x09,0x09,0x01,0x7F,0x00,0x00,0x00,0x3F,0x00,0x00,0x00,0x7F,0x00},
	{0x00,0x08,0x08,0x10,0x20,0x00,0xF8,0x08,0x08,0x08,0xF8,0x08,0x08,0x08,0xF8,0x08},/*"当",3*/
	{0x10,0x08,0x08,0xFF,0x00,0x3E,0x22,0x22,0x3E,0x22,0x22,0x3E,0x22,0x22,0x2A,0x24},
	{0x10,0x10,0x20,0xFE,0x00,0x08,0x48,0x48,0x48,0x48,0x48,0x48,0x08,0x08,0x28,0x10},/*"前",4*/
};


static const uint8_t Font16Pic[][2*48] =
{
	{
		0x00,0x00,0x00,0x3E,0x42,0x42,0x80,0x80,0x80,0x80,0x80,0x42,0x44,0x38,0x00,0x00,
		0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xC6,0x42,0x42,0x42,0x42,0x46,0x3B,0x00,0x00,
		0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xEE,0x32,0x20,0x20,0x20,0x20,0xF8,0x00,0x00,
		0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
		0x00,0x00,0x07,0x80,0x08,0x40,0x10,0x20,0x20,0x10,0x20,0x10,0x20,0x10,0x20,0x10,
		0x10,0x20,0x08,0x40,0x24,0x90,0x3C,0xF0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,

	},
	{
		0x00,0x07,0x1F,0x18,0x30,0x30,0x30,0x30,0x38,0x1C,0x08,0x00,0x00,0x07,0x07,0x00,
		0x00,0x00,0x00,0x07,0x07,0x00,0x00,0x07,0x07,0x03,0x06,0x06,0x00,0x00,0x00,0x00,
		0x00,0x00,0x00,0x00,0x00,0x07,0x1F,0x1C,0x38,0x30,0x30,0x30,0x38,0x1C,0x1F,0x07,
		0x00,0xE0,0xF8,0x18,0x0C,0x0C,0x0C,0x0C,0x1C,0x38,0x10,0x00,0x00,0xF8,0xFC,0x0C,
		0x0C,0x0C,0x18,0xFC,0xFC,0x00,0x00,0xFC,0xFC,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
		0x00,0x00,0x00,0x00,0x00,0xCC,0xEC,0x3C,0x1C,0x0C,0x00,0x0C,0x1C,0x3C,0xEC,0xCC,

	}
};

static const uint8_t Hanzi[] = {
/* GB2312 16x16点阵字库*/
/* 字串 麦道猪年发大财  112x16  */
0x80, 0x84, 0x94, 0x94, 0x94, 0x94, 0x94, 0xFF, 0x94, 0x94, 0x94, 0x94, 0x96,
		0xC4, 0x80, 0x00, 0x40, 0x42, 0x44, 0xCC, 0x00, 0x04, 0xE5, 0xB6, 0xAC,
		0xA4, 0xA4, 0xA6, 0xF5, 0x24, 0x00, 0x00, 0x40, 0x22, 0x14, 0x08, 0xF4,
		0x02, 0x25, 0xA4, 0x64, 0x3F, 0x34, 0x2C, 0xA4, 0x32, 0x20, 0x00, 0x00,
		0x20, 0x10, 0xCC, 0x47, 0x44, 0x44, 0xFC, 0x44, 0x44, 0x44, 0x64, 0x46,
		0x04, 0x00, 0x00, 0x00, 0x10, 0x18, 0x16, 0x10, 0x90, 0xF0, 0x9F, 0x90,
		0x90, 0x92, 0x94, 0x10, 0x18, 0x10, 0x00, 0x20, 0x20, 0x20, 0x20, 0x20,
		0x20, 0xA0, 0x7F, 0xA0, 0x20, 0x20, 0x20, 0x20, 0x30, 0x20, 0x00, 0x00,
		0xFE, 0x02, 0xFA, 0x02, 0xFF, 0x12, 0x10, 0x10, 0x10, 0xD0, 0xFF, 0x10,
		0x18, 0x10, 0x00, 0x00, 0x20, 0x90, 0x88, 0x46, 0x43, 0x26, 0x2A, 0x12,
		0x2A, 0x46, 0x42, 0x80, 0x80, 0x80, 0x00, 0x00, 0x40, 0x20, 0x1F, 0x20,
		0x40, 0xBF, 0xA4, 0xA4, 0xA4, 0xA4, 0xA4, 0xBF, 0xC0, 0x40, 0x00, 0x08,
		0x04, 0x42, 0x81, 0x7F, 0x02, 0x01, 0xFF, 0x49, 0x49, 0x49, 0x49, 0xFF,
		0x01, 0x00, 0x00, 0x04, 0x04, 0x04, 0x07, 0x04, 0x04, 0x04, 0xFF, 0x04,
		0x04, 0x04, 0x04, 0x04, 0x06, 0x04, 0x00, 0x40, 0x20, 0x90, 0x88, 0x46,
		0x41, 0x23, 0x14, 0x08, 0x14, 0x22, 0x21, 0x40, 0xC0, 0x40, 0x00, 0x00,
		0x40, 0x40, 0x20, 0x10, 0x0C, 0x03, 0x00, 0x01, 0x06, 0x08, 0x10, 0x20,
		0x60, 0x20, 0x00, 0x40, 0x27, 0x18, 0x07, 0x08, 0x37, 0x08, 0x04, 0x02,
		0x41, 0x80, 0x7F, 0x00, 0x00, 0x00, 0x00,

};

static const unsigned char Logo[] = { 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x18, 0x18, 0x7E,
		0xFF, 0x38, 0x10, 0x10, 0x10, 0x10, 0x10, 0x00, 0x20, 0x20, 0x20, 0x20,
		0x60, 0x60, 0x40, 0x40, 0xC0, 0xC0, 0x80, 0x80, 0x80, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x01, 0xFF, 0xFF, 0xFE, 0xFE, 0xFC, 0xFC, 0xF8, 0xF8, 0xF0,
		0xF0, 0xE0, 0xE0, 0xC0, 0x80, 0x80, 0x00, 0x00, 0x00, 0x00, 0x80, 0xC0,
		0xE0, 0xF0, 0xF8, 0xFC, 0xFE, 0xFE, 0xFF, 0xFE, 0xFE, 0xFE, 0xFC, 0xFC,
		0x08, 0x00, 0x01, 0x01, 0x01, 0x03, 0x07, 0x07, 0x0E, 0x1E, 0x3C, 0xFC,
		0xFC, 0xF8, 0xF0, 0xF0, 0xE0, 0xC0, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFF,
		0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0x07, 0x07, 0x0F, 0x0F, 0x1F, 0x1F,
		0x3F, 0x3F, 0x7F, 0x7F, 0xFF, 0xFF, 0x7F, 0x3F, 0x1F, 0x0F, 0x07, 0x03,
		0x01, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0xE0, 0xF9, 0xFF, 0xFF, 0xFF, 0xFF,
		0xFF, 0xFF, 0xFF, 0x7E, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
		0xFF, 0xFF, 0xE0, 0xE0, 0xE0, 0xE0, 0xE0, 0xE0, 0xE0, 0xE0, 0xE0, 0xE0,
		0xE0, 0xE0, 0xE0, 0xE0, 0xE0, 0xE0, 0xE0, 0xE0, 0xE0, 0xF3, 0xF3, 0xF3,
		0xF3, 0xF3, 0xF1, 0xF9, 0xF8, 0xF8, 0xF8, 0xFC, 0xFC, 0xFE, 0xFE, 0x7F,
		0x7F, 0x7F, 0x3F, 0x3F, 0x1F, 0x1F, 0x0F, 0x07, 0x03, 0x03, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xC0, 0xC0,
		0xC0, 0xC0, 0xC0, 0x80, 0x80, 0x00, 0x80, 0xC0, 0xC0, 0xC0, 0xC0, 0xC0,
		0x40, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0xC0, 0xC0, 0xC0,
		0xC0, 0xC0, 0xC4, 0x07, 0x07, 0x07, 0x07, 0x0F, 0x0F, 0x0F, 0x0F, 0x4F,
		0xCF, 0xCF, 0xCF, 0xCF, 0x8F, 0xCF, 0xCF, 0xCF, 0xCF, 0xCF, 0x4F, 0x07,
		0x07, 0x07, 0x87, 0xC7, 0xC7, 0xC7, 0xC7, 0xC3, 0xC3, 0xC3, 0xC3, 0xC3,
		0xC1, 0xC1, 0x81, 0x01, 0x00, 0x00, 0x00, 0x00, 0x80, 0xC0, 0xC0, 0xC0,
		0xC0, 0xC0, 0xC0, 0xC0, 0xC0, 0xC0, 0xC0, 0x80, 0x00, 0x00, 0x00, 0x00,
		0xC0, 0xC0, 0xC0, 0xC0, 0xC0, 0xC0, 0x80, 0x80, 0xC0, 0xC0, 0xC0, 0xC0,
		0x00, 0x00, 0x00, 0x00, 0x80, 0xC0, 0xC0, 0xC0, 0xC0, 0xC0, 0xC0, 0xC0,
		0xC0, 0xC0, 0xC0, 0xC0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x70, 0x7C, 0x7E, 0x7E, 0x1E, 0x06, 0x02, 0x02, 0x06,
		0x06, 0x62, 0x7A, 0x7E, 0x7E, 0x3E, 0x0E, 0x02, 0x40, 0x60, 0x70, 0x78,
		0x78, 0x3C, 0x3E, 0x1E, 0x0E, 0x06, 0x06, 0x06, 0x1E, 0x7E, 0x7E, 0x7E,
		0x78, 0x00, 0x00, 0x60, 0x60, 0x70, 0x78, 0x7C, 0x3E, 0x3E, 0x7E, 0x7E,
		0x7E, 0x7E, 0x62, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x70, 0x7E, 0x7E,
		0x7E, 0x7E, 0x66, 0x70, 0x70, 0x70, 0x38, 0x3E, 0x1E, 0x1E, 0x06, 0x00,
		0x00, 0x00, 0x3C, 0x3E, 0x3E, 0x7E, 0x66, 0x60, 0x60, 0x70, 0x38, 0x3E,
		0x3E, 0x1E, 0x06, 0x00, 0x00, 0x60, 0x7C, 0x7E, 0x7E, 0x3E, 0x06, 0x02,
		0x02, 0x76, 0x7E, 0x7E, 0x7E, 0x3E, 0x06, 0x00, 0x00, 0x00, 0x60, 0x7C,
		0x7E, 0x7E, 0x7E, 0x7E, 0x66, 0x76, 0x76, 0x76, 0x76, 0x06, 0x02, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, };

unsigned char const IPC[] = {
/*------------------------------------------------------------------------------
 ;  源文件 / 文字 : 来自剪贴板!字模
 ;  宽×高（像素）: 128×48
 ------------------------------------------------------------------------------*/
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x80, 0x80, 0xC0, 0xC0, 0xE0, 0xE0, 0xE0, 0xF0, 0x70, 0x70, 0x30,
		0x38, 0xB8, 0x98, 0xD8, 0xDC, 0xDC, 0xCC, 0xEC, 0xEC, 0xEC, 0xE6, 0xF6,
		0xF6, 0xF6, 0xF6, 0xF6, 0xF6, 0xF6, 0xF2, 0xF2, 0xFA, 0xFA, 0xFA, 0xFA,
		0xF0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xC0, 0xE0, 0x30, 0x38,
		0x18, 0xEC, 0xEC, 0x6C, 0x6C, 0xEC, 0xC8, 0x18, 0x30, 0xE0, 0xC0, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0xC0, 0xE0, 0xF0, 0xF8, 0xFC, 0xFC, 0xFE, 0xFF, 0x7F, 0xBF, 0xDF, 0xEF,
		0xF7, 0x7B, 0x3D, 0x3C, 0x1E, 0x1E, 0x1F, 0x0F, 0x0F, 0x0F, 0x07, 0x07,
		0x07, 0x07, 0x07, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03,
		0x03, 0x03, 0x03, 0x01, 0x01, 0x01, 0x81, 0xF9, 0xF8, 0xF8, 0xF8, 0xF8,
		0xF8, 0xF8, 0x38, 0x00, 0x00, 0xC0, 0xF8, 0xF8, 0xF8, 0xF8, 0xF8, 0xF8,
		0xF8, 0xF8, 0xF8, 0xF8, 0xF8, 0xF8, 0xF8, 0xF8, 0xF8, 0xF0, 0xF0, 0xE0,
		0xC0, 0x00, 0x00, 0x00, 0x00, 0x80, 0xC0, 0xE0, 0xF0, 0xF0, 0xF8, 0xF8,
		0xF8, 0xF8, 0xFC, 0xFC, 0xFC, 0xFC, 0xFC, 0xF8, 0xF0, 0xF0, 0xF0, 0xE0,
		0x80, 0x00, 0x00, 0x1F, 0x3F, 0x70, 0xC0, 0x80, 0x00, 0x7F, 0x7F, 0x06,
		0x06, 0x1F, 0x79, 0x60, 0x80, 0xC0, 0x7F, 0x1F, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
		0xFF, 0xFF, 0xFF, 0x80, 0x07, 0x03, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0xE0, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0x0F, 0x00, 0x00,
		0xF0, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xE1, 0xE1, 0xE1,
		0xE1, 0xE1, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0x7F, 0x3F, 0x07, 0xF0, 0xFC,
		0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0x0F, 0x03, 0x01, 0x00, 0x00, 0x00,
		0x00, 0x03, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x01, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03,
		0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x03, 0x07, 0x0F, 0x1F, 0x3F, 0x7F, 0xFF, 0xFF,
		0xFF, 0xFE, 0xF8, 0xF0, 0xE0, 0xE0, 0xC0, 0x80, 0x80, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xF8, 0xFF, 0xFF, 0xFF,
		0xFF, 0xFF, 0xFF, 0xFF, 0x03, 0x00, 0x00, 0xFC, 0xFF, 0xFF, 0xFF, 0xFF,
		0xFF, 0xFF, 0x7F, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x03, 0x03,
		0x03, 0x01, 0x00, 0x00, 0x00, 0x00, 0x1F, 0x7F, 0xFF, 0xFF, 0xFF, 0xFF,
		0xFF, 0xFF, 0xF8, 0xF0, 0xF0, 0xF0, 0xF0, 0xF8, 0xFE, 0xFF, 0xFF, 0x7F,
		0x7F, 0x3F, 0x1F, 0x07, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x01, 0x03, 0x03,
		0x07, 0x07, 0x0F, 0x0F, 0x0F, 0x1F, 0x1F, 0x1E, 0x3E, 0x3E, 0x3C, 0x3C,
		0x38, 0x78, 0x78, 0x78, 0x70, 0x60, 0x60, 0xE0, 0xE0, 0xE0, 0xE0, 0xE0,
		0xE0, 0xE0, 0xE0, 0xE3, 0xE3, 0xC3, 0xC3, 0xC3, 0xC3, 0xC3, 0xC3, 0xC0,
		0x40, 0x40, 0x43, 0x43, 0x63, 0x63, 0x63, 0x23, 0x23, 0x01, 0x00, 0x00,
		0x00, 0xF0, 0xF0, 0xF0, 0xF0, 0xE0, 0x00, 0x00, 0x80, 0xD0, 0xF0, 0xF0,
		0xF0, 0x10, 0x00, 0x00, 0x80, 0x80, 0x81, 0x81, 0x03, 0x03, 0x03, 0x03,
		0x83, 0x83, 0x83, 0x83, 0x01, 0x01, 0x80, 0x80, 0x80, 0x00, 0x00, 0x00,
		0x00, 0xF0, 0xF8, 0xF8, 0x80, 0x80, 0x80, 0x00, 0x00, 0x00, 0x00, 0x80,
		0x80, 0x80, 0x80, 0x00, 0x00, 0x00, 0x80, 0x80, 0x00, 0x00, 0x80, 0x80,
		0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x60, 0x7C, 0x7F, 0x1F, 0x00,
		0x0F, 0x3F, 0x38, 0x3F, 0x0F, 0x61, 0x7C, 0x7F, 0x43, 0x00, 0x3E, 0x7F,
		0x67, 0x65, 0x65, 0x77, 0x37, 0x00, 0x78, 0x7F, 0x1F, 0x03, 0x03, 0x3F,
		0x3F, 0x3F, 0x03, 0x03, 0x7F, 0x7F, 0x00, 0x60, 0x7F, 0x7F, 0x7F, 0x63,
		0x61, 0x7F, 0x3F, 0x1F, 0x00, 0x3E, 0x7F, 0x67, 0x65, 0x65, 0x77, 0x37,
		0x00, 0x00, 0x7F, 0x7F, 0x06, 0x03, 0x01, 0x01, 0x01, 0x00, 0x00, };

void MD_OLED_Write_i(uint8_t cmd) {
	GPIO_PinOutClear(gpioPortA, 1U);
	//GPIO_PinOutSet
	USART_SpiTransfer( USART3, cmd);
}

void MD_OLED_Write_d(uint8_t dat) {
	GPIO_PinOutSet(gpioPortA, 1U);
	USART_SpiTransfer( USART3, dat);
}

uint8_t test[] = { 1, 3, 7, 15, 31, 63, 127, 255 };

void CleanOLED(void) {
	int i, j;

	for (j = 0; j < 8; j++) {
		MD_OLED_Write_i(0xB0 + j);
		MD_OLED_Write_i(0x00);
		MD_OLED_Write_i(0x10);

		for (i = 0; i < 128; i++) {
			MD_OLED_Write_d(0x00);
		}
	}
#if 0
	for (j=0; j < 2; j++)
	{
		MD_OLED_Write_i(0xB0 + j);
		MD_OLED_Write_i(0x00);
		MD_OLED_Write_i(0x10);

		for (i = 0; i < 112; i++)
		{
			MD_OLED_Write_d(Hanzi[(j%2)*112 + i]);
		}
	}
#endif
}

void DrawHanzi(unsigned char offset) {
	int i, j;
	unsigned char Hi,Low;

	offset %= 128;
	Hi = offset >> 4;
	Low = offset & 0x0F;

	for (j = 0; j < 2; j++) {
		MD_OLED_Write_i(0xB0 + j);
		MD_OLED_Write_i(0x00 + Low);
		MD_OLED_Write_i(0x10 + Hi);


		for (i = 0; i < 112; i++) {
			MD_OLED_Write_d(Hanzi[(j % 2) * 112 + i]);
		}

		for(i = 112; i<128;i++) {
			MD_OLED_Write_d(0);
		}
	}
}

void DrawLogo(void) {
	int i, j;

	for (j = 2; j < 8; j++) {
		MD_OLED_Write_i(0xB0 + j);
		MD_OLED_Write_i(0x00 + 0);
		MD_OLED_Write_i(0x10 + 0);

		for (i = 0; i < 128; i++) {
			MD_OLED_Write_d(Logo[i + (j - 2) * 128]);
		}
	}
}

void DrawIPC(void) {
	int i, j;

	for (j = 2; j < 8; j++) {
		MD_OLED_Write_i(0xB0 + j);
		MD_OLED_Write_i(0x00 + 0);
		MD_OLED_Write_i(0x10 + 0);

		for (i = 0; i < 128; i++) {
			MD_OLED_Write_d(IPC[i + (j - 2) * 128]);
		}
	}
}

void Draw16(int row, char col, font16enum font16char)
{
	int i;
	unsigned char rowhi, rowlo;

	if ((row >= 128) || (row < 0)) row = 0;
	if ((col >=8) || (col < 0)) col = 0;

	rowhi = row / 16;
	rowlo = row % 16;

   MD_OLED_Write_i(0xB0 + col);
   MD_OLED_Write_i(0x00 + rowlo);
   MD_OLED_Write_i(0x10 + rowhi);

   for (i = 0; i < 16; i++)
   {
	   MD_OLED_Write_d(Font16[font16char][i]);
   }
}

void Draw4816NumWithMinus(int row, bool minus, uint8_t hi, uint8_t lo)
{
	uint8_t i, j;
	unsigned char rowhi, rowlo;
	unsigned char offset[2] = {5, 2};

	if ((row >= 128) || (row < 0)) row = 0;
	if (hi >= 11) hi = 10;
	if (lo >= 10) lo = 0;

	rowhi = row / 16;
	rowlo = row % 16;

	for(j = 0; j < 2; j++)
	{
		MD_OLED_Write_i(0xB0 + 7 - j);
		MD_OLED_Write_i(0x00 + rowlo);
		MD_OLED_Write_i(0x10 + rowhi);

		for (i = 0; i < 14; i++)
		{
		   MD_OLED_Write_d(0);
		}

		for (i = 14; i < 37; i++)
		{
			unsigned char date;
			unsigned char index = i - 14;
		   if(j == 0) {
			   date = (Font4816Dot[hi][index * 2] >> offset[0]);
			   if(( index >= 11) && (index <= 12)){
				   if (minus)
					   date |= 0xF8;
		   	   }
		   } else {
			   date = ((Font4816Dot[hi][index * 2 + 1] >> offset[0]) | (Font4816Dot[hi][index * 2] << (8-offset[0])));
		   }
		   MD_OLED_Write_d(date);
		}

		for (i = 37; i < 48; i++)
		{
		   MD_OLED_Write_d(0);
		}

	}

	for(j = 0; j < 2; j++)
	{
		MD_OLED_Write_i(0xB0 + 7 - 2 - j);
		MD_OLED_Write_i(0x00 + rowlo);
		MD_OLED_Write_i(0x10 + rowhi);

		for (i = 0; i < 14; i++)
		{
		   MD_OLED_Write_d(0);
		}

		for (i = 14; i < 37; i++)
		{
			unsigned char date;
			unsigned char index = i - 14;
		   if(j == 0) {
			   date = (Font4816Dot[lo][index * 2] >> offset[1]);
			   date |= (Font4816Dot[hi][index * 2 + 1] << (8-offset[0]));
		   } else {
			   date = ((Font4816Dot[lo][index * 2 + 1] >> offset[1]) | (Font4816Dot[lo][index * 2] << (8-offset[1])));
		   }
		   MD_OLED_Write_d(date);
		}

		for (i = 37; i < 48; i++)
		{
		   MD_OLED_Write_d(0);
		}

	}
}



void Draw4816DotNumEx(bool Dot, int row, char col, uint8_t num)
{
	uint8_t i, j;
	unsigned char rowhi, rowlo;

	if ((row >= 128) || (row < 0)) row = 0;
	if ((col >=8) || (col < 0)) col = 0;
	if (num >= 10) num = 0;

	rowhi = row / 16;
	rowlo = row % 16;

	for(j = 0; j < 2; j++)
	{
		MD_OLED_Write_i(0xB0 + 7 - col * 2 - j);
		MD_OLED_Write_i(0x00 + rowlo);
		MD_OLED_Write_i(0x10 + rowhi);

		for (i = 0; i < 14; i++)
		{
		   MD_OLED_Write_d(0);
		}

		for (i = 14; i < 37; i++)
		{
			unsigned char date;
			unsigned char index = i - 14;
		   if(j == 0) {
			   date = (Font4816Dot[num][index * 2] >> 3);
			   if((index >= (23 - 3)) && Dot)
				   date |= 0xE0;
		   } else {
			   date = ((Font4816Dot[num][index * 2 + 1] >> 3) | (Font4816Dot[num][index * 2] << 5));
		   }
		   MD_OLED_Write_d(date);
		}

		for (i = 37; i < 48; i++)
		{
		   MD_OLED_Write_d(0);
		}

	}
}

void Draw4816DotNum(int row, char col, uint8_t num)
{
	Draw4816DotNumEx(true, row, col, num);
}


void Draw4816WithMinus(int row, int32_t num)
{
	uint8_t T_hi, T_lo, T_dot;
	bool Minus = false;
	if(num >= 999){
		T_hi = T_lo = T_dot = 9;
		Minus = false;
	} else if (num <= -999) {
		T_hi = T_lo = T_dot = 9;
		Minus = true;
	} else {
		if(num < 0) {
			Minus = true;
			num = 0 - num;
		}

		T_hi = (num / 100);
		T_lo = ((num /10 )% 10);
		T_dot = (num % 10);
	}

	if (T_hi == 0) T_hi = 10;

	Draw4816NumWithMinus(row, Minus, T_hi, T_lo);

	Draw4816DotNum(row, 2, T_dot);
}

void Drawhumiture(unsigned int H, unsigned int T)
{
	Draw16(0, 7, font16_R);
	Draw16(0, 6, font16_H);
	Draw16(0, 5, font16_clean);
	Draw16(0, 4, font16_clean);
	Draw16(0, 3, font16_clean);
	Draw16(0, 2, font16_percent);

	Draw4816WithMinus(16, H);

	Draw16(64, 7, font16_T);
	Draw16(64, 6, font16_clean);
	Draw16(64, 5, font16_clean);
	Draw16(64, 4, font16_clean);
	Draw16(64, 3, font16_c1);
	Draw16(64, 2, font16_c2);

	Draw4816WithMinus(80, T);
}

void CleanGndAlert(void)
{
	for(int col = 2; col <=7; col++)
	{
		Draw16(16, col, font16_clean);
		Draw16(32, col, font16_clean);
		Draw16(48, col, font16_clean);
	}
}

void DrawGround(unsigned int set, unsigned int cur)
{
/*
	Draw16(0, 7, font16_S);
	Draw16(0, 6, font16_e);
	Draw16(0, 5, font16_t);
	Draw16(0, 4, font16_clean);
	Draw16(0, 3, font16_clean);
	Draw16(0, 2, font16_clean);
*/

	Draw16(0, 7, font16_alert1);
	Draw16(0, 6, font16_alert2);
	Draw16(0, 5, font16_alert3);
	Draw16(0, 4, font16_alert4);
	Draw16(0, 3, font16_value1);
	Draw16(0, 2, font16_value2);


	Draw16(0, 1, font16_clean);
	Draw16(0, 0, font16_clean);
	Draw16(16, 1, font16_clean);
	Draw16(16, 0, font16_clean);
	Draw16(20, 1, font16_clean);
	Draw16(20, 0, font16_clean);

	Draw16(32, 1, font16_Ohm1);
	Draw16(32, 0, font16_Ohm2);

	Draw4816WithMinus(16, set);

/*
	Draw16(64, 7, font16_C);
	Draw16(64, 6, font16_u);
	Draw16(64, 5, font16_r);
	Draw16(64, 4, font16_clean);
	Draw16(64, 3, font16_clean);
	Draw16(64, 2, font16_clean);
*/

	Draw16(64, 7, font16_Current1);
	Draw16(64, 6, font16_Current2);
	Draw16(64, 5, font16_Current3);
	Draw16(64, 4, font16_Current4);
	Draw16(64, 3, font16_value1);
	Draw16(64, 2, font16_value2);


	Draw16(52, 1, font16_clean);
	Draw16(52, 0, font16_clean);

	Draw16(68, 1, font16_clean);
	Draw16(68, 0, font16_clean);

	Draw16(84, 1, font16_clean);
	Draw16(84, 0, font16_clean);

	Draw16(96, 1, font16_Ohm1);
	Draw16(96, 0, font16_Ohm2);

	Draw16(116, 1, font16_clean);
	Draw16(116, 0, font16_clean);

	Draw4816WithMinus(80, cur);
}

void Write_Command(uint8_t cmd) {
	MD_OLED_Write_i(cmd);
}

void Write_Data(uint8_t data) {
	MD_OLED_Write_d(data);
}

void Wait_Flash_WarmUp() {
	volatile int time_cnt = 100000;
	while (time_cnt > 0) {
		time_cnt--;
	}
}

void MD_KEY_init(void) {
	//PD7 key
	//GPIO_PinModeSet(gpioPortD, 7U, gpioModeInput, 1);

	//PF2
	GPIO_PinModeSet(gpioPortF, 2U, gpioModeInput, 1);
}

void MD_OLED_init(void) {
	USART_InitSync_TypeDef init = USART_INITSYNC_DEFAULT;

	CMU_ClockEnable(cmuClock_GPIO, true);
	CMU_ClockEnable(cmuClock_USART3, true);

	init.msbf = true;
	init.baudrate = SPI_BAUDRATE;
	init.autoCsEnable = true;
	USART_InitSync( USART3, &init);

	/* IO config */
	GPIO_PinModeSet(gpioPortA, 0U, gpioModePushPull, 1);
	GPIO_PinModeSet(gpioPortA, 1U, gpioModePushPull, 1);
	GPIO_PinModeSet(gpioPortA, 2U, gpioModePushPull, 1);
	GPIO_PinModeSet(gpioPortC, 14U, gpioModePushPull, 1);
	GPIO_PinModeSet(gpioPortC, 15U, gpioModePushPull, 1);

	USART3->ROUTELOC0 = ( USART_ROUTELOC0_CLKLOC_LOC0
			| USART_ROUTELOC0_TXLOC_LOC0 | USART_ROUTELOC0_CSLOC_LOC2);
	USART3->ROUTEPEN = ( USART_ROUTEPEN_CSPEN | USART_ROUTEPEN_TXPEN
			| USART_ROUTEPEN_CLKPEN);

	Wait_Flash_WarmUp();

	GPIO_PinOutClear(gpioPortC, 15U);
	Wait_Flash_WarmUp();
	GPIO_PinOutSet(gpioPortC, 15U);
	Wait_Flash_WarmUp();
	MD_OLED_Write_i(0xAE);
	MD_OLED_Write_i(0x00);
	MD_OLED_Write_i(0x10);
	MD_OLED_Write_i(0x40);
	MD_OLED_Write_i(0xB0);
	MD_OLED_Write_i(0x81);
	MD_OLED_Write_i(0xCF);

	MD_OLED_Write_i(0xA1);
	MD_OLED_Write_i(0xA6);
	MD_OLED_Write_i(0xA8);
	MD_OLED_Write_i(0x3F);
	MD_OLED_Write_i(0xC8);
	MD_OLED_Write_i(0xD3);
	MD_OLED_Write_i(0x00);
	MD_OLED_Write_i(0xD5);
	MD_OLED_Write_i(0x80);
	MD_OLED_Write_i(0xD9);
	MD_OLED_Write_i(0xF1);

	MD_OLED_Write_i(0xDA);
	MD_OLED_Write_i(0x12);
	MD_OLED_Write_i(0xDB);
	MD_OLED_Write_i(0x40);
	MD_OLED_Write_i(0x8D);
	MD_OLED_Write_i(0x14);
	MD_OLED_Write_i(0xAF);
	Wait_Flash_WarmUp();
	CleanOLED();
}

void MD_OLED_OFF(void) {
	MD_OLED_Write_i(0xAE);
	MD_OLED_Write_i(0x8D);
	MD_OLED_Write_i(0x10);
}

